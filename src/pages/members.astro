---
const memberGlob = import.meta.glob('../../members/*/info.js', { eager: true });
const allMembers = Object.values(memberGlob) as any[];
const members: any[] = [];

// Sort members by order first
const orderedMembers = allMembers
    .filter((m: any) => m.default.order)
    .sort((a: any, b: any) => (a.default.order || 0) - (b.default.order || 0));

members.push(...orderedMembers);

// Get unique roles excluding 'Member' and sort them
const roleMembers = [...new Set(
    allMembers
        .filter((m: any) => m.default.role?.name && m.default.role.name !== 'Member' && !m.default.order)
        .map((m: any) => m.default.role.name)
)].sort();

// Add members by role
roleMembers.forEach(role => {
    const membersWithRole = allMembers.filter((m: any) =>
        m.default.role?.name === role && !m.default.order
    );
    members.push(...membersWithRole);
});

// Add remaining regular members
const regularMembers = allMembers.filter((m: any) =>
    (!m.default.role || m.default.role.name === 'Member') &&
    !m.default.order
);
members.push(...regularMembers);

import Layout from '../layouts/Layout.astro';
import Hero from '../components/hero.astro';
import '../styles/pages/members.scss';
import '../styles/photos.scss';
---
<Layout title="Members">
    <main id="content">
        <Hero classItems="fullHeight">
            <ul id="menu">
                <h1>Club Members</h1>
                {members.map((m: any) => {
                    const member = m.default || m
                    if (!member.username?.startsWith('_') && member.status === 'active') {
                        const username = member.username
                        const role = member.role && member.role.name !== 'Member' ? member.role.name : ''
                        return (
                            <a href={`/members/${username}/`}>
                                <li>
                                    {member.name}
                                    {role && <span id="tag">({role})</span>}
                                </li>
                            </a>
                        )
                    }
                    return null
                })}
            </ul>
        </Hero>
    </main>
    <script is:inline>
        if (location.href.includes('?m=')) {
            location.href = location.pathname
        }
    </script>
</Layout>